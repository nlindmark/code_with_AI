{% extends "base.html" %}

{% block title %}{{ problem.title }} - Code with AI{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h2 style="color: #333; margin-bottom: 20px;">{{ problem.title }}</h2>
    
    {% if success %}
    <div class="alert alert-success" id="success-message" style="display: block; text-align: center; font-size: 1.2em; padding: 30px;">
        âœ… <strong>RÃ¤tt svar! NivÃ¥ {{ level_id }} klar!</strong>
        {% if next_level %}
        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">Du gÃ¥r vidare till nivÃ¥ {{ next_level }} om 2 sekunder...</p>
        {% else %}
        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">Du gÃ¥r vidare till leaderboard om 2 sekunder...</p>
        {% endif %}
    </div>
    {% endif %}
    
    {% if error %}
    <div class="alert alert-error">
        {{ error }}
    </div>
    {% endif %}
    
    {% if not success %}
    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
        <h3 style="margin-bottom: 15px; color: #333;">Problembeskrivning:</h3>
        <div style="white-space: pre-line; font-family: 'Courier New', monospace; background-color: white; padding: 15px; border-radius: 3px; border: 1px solid #ddd;">
{{ problem.description }}
        </div>
        {% if problem.input_file %}
        <div style="margin-top: 15px; padding: 15px; background-color: #e8f5e9; border-radius: 5px; border-left: 4px solid #4caf50;">
            <strong>ðŸ“¥ Input-fil:</strong>
            <p style="margin: 10px 0; color: #666;">Ladda ner input-filen fÃ¶r att bearbeta den med ditt program:</p>
            <a href="{{ url_for('download_input_file', competition_id=competition_id, level_id=level_id, filename=problem.input_file) }}" 
               class="btn" 
               style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); margin-top: 10px; display: inline-block;">
                ðŸ“¥ Ladda ner {{ problem.input_file }}
            </a>
        </div>
        {% endif %}
    </div>
    
    <form method="POST" action="{{ url_for('submit', level_id=level_id) }}">
        <div class="form-group">
            <label for="answer">Ditt svar:</label>
            <input type="{{ problem.input_type }}" 
                   id="answer" 
                   name="answer" 
                   class="form-control" 
                   placeholder="{{ problem.placeholder }}"
                   required
                   autofocus>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" class="btn">
                Skicka svar
            </button>
            
            <a href="{{ url_for('leaderboard') }}" class="btn btn-secondary">
                Visa leaderboard
            </a>
        </div>
    </form>
    
    {% if problem.solution_file %}
    <div style="margin-top: 30px; padding: 15px; background-color: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
        <button id="show-solution-btn" 
                onclick="toggleSolution()" 
                class="btn" 
                style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); margin-bottom: 15px;">
            ðŸ’¡ Visa lÃ¶sningsprogram
        </button>
        <div id="solution-container" style="display: none;">
            <h4 style="margin-bottom: 10px; color: #333;">LÃ¶sningsprogram:</h4>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #ddd; overflow-x: auto;">
                <pre id="solution-code" style="margin: 0; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; color: #333;"></pre>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if problem.hint %}
    <div style="margin-top: 30px; padding: 15px; background-color: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
        <strong>ðŸ’¡ Tips:</strong> 
        <p style="margin-top: 10px; margin-bottom: 0;">{{ problem.hint }}</p>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if success %}
<script>
    // Visa success-meddelande och redirecta efter 2 sekunder
    setTimeout(function() {
        window.location.href = '{{ next_url }}';
    }, 2000);
</script>
{% endif %}

{% if problem.solution_file %}
<script>
    let solutionLoaded = false;
    let solutionVisible = false;
    
    function toggleSolution() {
        const container = document.getElementById('solution-container');
        const btn = document.getElementById('show-solution-btn');
        
        if (!solutionLoaded) {
            // Ladda lÃ¶sningen frÃ¥n servern
            fetch('{{ url_for("get_solution", competition_id=competition_id, level_id=level_id) }}')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Kunde inte ladda lÃ¶sningen');
                    }
                    return response.text();
                })
                .then(code => {
                    document.getElementById('solution-code').textContent = code;
                    solutionLoaded = true;
                    showSolution();
                })
                .catch(error => {
                    document.getElementById('solution-code').textContent = 'Fel vid laddning av lÃ¶sning: ' + error.message;
                    showSolution();
                });
        } else {
            // Toggle visibility
            if (solutionVisible) {
                hideSolution();
            } else {
                showSolution();
            }
        }
    }
    
    function showSolution() {
        document.getElementById('solution-container').style.display = 'block';
        document.getElementById('show-solution-btn').textContent = 'ðŸ™ˆ DÃ¶lj lÃ¶sningsprogram';
        solutionVisible = true;
    }
    
    function hideSolution() {
        document.getElementById('solution-container').style.display = 'none';
        document.getElementById('show-solution-btn').textContent = 'ðŸ’¡ Visa lÃ¶sningsprogram';
        solutionVisible = false;
    }
</script>
{% endif %}
{% endblock %}


