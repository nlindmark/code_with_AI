{% extends "base.html" %}

{% block title %}{{ problem.title }} - Code with AI{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h2 style="color: #333; margin-bottom: 20px;">{{ problem.title }}</h2>
    
    {% if success %}
    <div class="alert alert-success" id="success-message" style="display: block; text-align: center; font-size: 1.2em; padding: 30px;">
        ✅ <strong>{{ t('level', 'correct_answer', level_id) }}</strong>
        {% if next_level %}
        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">{{ t('level', 'next_level', next_level) }}</p>
        {% else %}
        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">{{ t('level', 'next_leaderboard') }}</p>
        {% endif %}
    </div>
    {% endif %}
    
    {% if error %}
    <div class="alert alert-error">
        {{ error }}
    </div>
    {% endif %}
    
    {% if not success %}
    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
        <h3 style="margin-bottom: 15px; color: #333;">{{ t('level', 'problem_description') }}</h3>
        <div style="white-space: pre-line; font-family: 'Courier New', monospace; background-color: white; padding: 15px; border-radius: 3px; border: 1px solid #ddd;">
{{ problem.description }}
        </div>
        {% if problem.input_file %}
        <div style="margin-top: 15px; padding: 15px; background-color: #e8f5e9; border-radius: 5px; border-left: 4px solid #4caf50;">
            <strong>{{ t('level', 'input_file') }}</strong>
            <p style="margin: 10px 0; color: #666;">{{ t('level', 'download_input') }}</p>
            <a href="{{ url_for('download_input_file', competition_id=competition_id, level_id=level_id, filename=problem.input_file) }}" 
               class="btn" 
               style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); margin-top: 10px; display: inline-block;">
                {{ t('level', 'download', problem.input_file) }}
            </a>
        </div>
        {% endif %}
    </div>
    
    <form method="POST" action="{{ url_for('submit', level_id=level_id) }}">
        <div class="form-group">
            <label for="answer">{{ t('level', 'your_answer') }}:</label>
            <input type="{{ problem.input_type }}" 
                   id="answer" 
                   name="answer" 
                   class="form-control" 
                   placeholder="{{ problem.placeholder }}"
                   required
                   autofocus>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" class="btn">
                {{ t('level', 'submit_answer') }}
            </button>
            
            <a href="{{ url_for('leaderboard') }}" class="btn btn-secondary">
                {{ t('level', 'view_leaderboard') }}
            </a>
        </div>
    </form>
    
    {% if problem.solution_file %}
    <div style="margin-top: 30px; padding: 15px; background-color: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
        <button id="show-solution-btn" 
                onclick="toggleSolution()" 
                class="btn" 
                style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); margin-bottom: 15px;">
            {{ t('level', 'show_solution') }}
        </button>
        <div id="solution-container" style="display: none;">
            <h4 style="margin-bottom: 10px; color: #333;">{{ t('level', 'solution_program') }}</h4>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #ddd; overflow-x: auto;">
                <pre id="solution-code" style="margin: 0; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; color: #333;"></pre>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if problem.hint %}
    <div style="margin-top: 30px; padding: 15px; background-color: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
        <button id="show-hint-btn" 
                onclick="toggleHint()" 
                class="btn" 
                style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); margin-bottom: 15px;">
            {{ t('level', 'show_hint') }}
        </button>
        <div id="hint-container" style="display: none;">
            <h4 style="margin-bottom: 10px; color: #333;">{{ t('level', 'hint') }}</h4>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #ddd;">
                <p style="margin: 0; color: #333;">{{ problem.hint }}</p>
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if success %}
<script>
    // Visa success-meddelande och redirecta efter 2 sekunder
    setTimeout(function() {
        window.location.href = '{{ next_url }}';
    }, 2000);
</script>
{% endif %}

{% if problem.solution_file %}
<script>
    const translations = {{ translations|tojson }};
    
    function t(category, key, ...args) {
        let text = translations[category] && translations[category][key] ? translations[category][key] : key;
        if (args.length > 0) {
            try {
                return text.replace(/\{\}/g, () => args.shift() || '');
            } catch (e) {
                return text;
            }
        }
        return text;
    }
    
    let solutionLoaded = false;
    let solutionVisible = false;
    
    function toggleSolution() {
        const container = document.getElementById('solution-container');
        const btn = document.getElementById('show-solution-btn');
        
        if (!solutionLoaded) {
            // Ladda lösningen från servern
            fetch('{{ url_for("get_solution", competition_id=competition_id, level_id=level_id) }}')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(t('level', 'error_load_solution'));
                    }
                    return response.text();
                })
                .then(code => {
                    document.getElementById('solution-code').textContent = code;
                    solutionLoaded = true;
                    showSolution();
                })
                .catch(error => {
                    document.getElementById('solution-code').textContent = t('level', 'error_load_solution') + ': ' + error.message;
                    showSolution();
                });
        } else {
            // Toggle visibility
            if (solutionVisible) {
                hideSolution();
            } else {
                showSolution();
            }
        }
    }
    
    function showSolution() {
        document.getElementById('solution-container').style.display = 'block';
        document.getElementById('show-solution-btn').textContent = t('level', 'hide_solution');
        solutionVisible = true;
    }
    
    function hideSolution() {
        document.getElementById('solution-container').style.display = 'none';
        document.getElementById('show-solution-btn').textContent = t('level', 'show_solution');
        solutionVisible = false;
    }
</script>
{% endif %}

{% if problem.hint %}
<script>
    const translations = {{ translations|tojson }};
    
    function t(category, key, ...args) {
        let text = translations[category] && translations[category][key] ? translations[category][key] : key;
        if (args.length > 0) {
            try {
                return text.replace(/\{\}/g, () => args.shift() || '');
            } catch (e) {
                return text;
            }
        }
        return text;
    }
    
    let hintVisible = false;
    
    function toggleHint() {
        const container = document.getElementById('hint-container');
        const btn = document.getElementById('show-hint-btn');
        
        if (hintVisible) {
            hideHint();
        } else {
            showHint();
        }
    }
    
    function showHint() {
        document.getElementById('hint-container').style.display = 'block';
        document.getElementById('show-hint-btn').textContent = t('level', 'hide_hint');
        hintVisible = true;
    }
    
    function hideHint() {
        document.getElementById('hint-container').style.display = 'none';
        document.getElementById('show-hint-btn').textContent = t('level', 'show_hint');
        hintVisible = false;
    }
</script>
{% endif %}
{% endblock %}


